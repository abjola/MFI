clc
clear all 
close all 


%% Colormap
BluetoRed=[0 0.450980395078659 0.74117648601532;0.0322580635547638 0.468690693378448 0.749525606632233;0.0645161271095276 0.48640102148056 0.75787478685379;0.0967741906642914 0.504111349582672 0.766223907470703;0.129032254219055 0.521821618080139 0.774573087692261;0.161290317773819 0.539531946182251 0.782922208309174;0.193548381328583 0.557242274284363 0.791271388530731;0.225806444883347 0.57495254278183 0.799620509147644;0.25806450843811 0.592662870883942 0.807969629764557;0.290322571992874 0.610373198986053 0.816318809986115;0.322580635547638 0.628083467483521 0.824667930603027;0.354838699102402 0.645793795585632 0.833017110824585;0.387096762657166 0.663504123687744 0.841366231441498;0.419354826211929 0.681214451789856 0.849715352058411;0.451612889766693 0.698924720287323 0.858064532279968;0.483870953321457 0.716635048389435 0.866413652896881;0.516129016876221 0.734345376491547 0.874762833118439;0.548387110233307 0.752055644989014 0.883111953735352;0.580645143985748 0.769765973091125 0.891461133956909;0.612903237342834 0.787476301193237 0.899810254573822;0.645161271095276 0.805186569690704 0.908159375190735;0.677419364452362 0.822896897792816 0.916508555412292;0.709677398204803 0.840607225894928 0.924857676029205;0.74193549156189 0.858317494392395 0.933206856250763;0.774193525314331 0.876027822494507 0.941555976867676;0.806451618671417 0.893738150596619 0.949905097484589;0.838709652423859 0.91144847869873 0.958254277706146;0.870967745780945 0.929158747196198 0.966603398323059;0.903225779533386 0.946869075298309 0.974952578544617;0.935483872890472 0.964579403400421 0.98330169916153;0.967741906642914 0.982289671897888 0.991650879383087;1 1 1;0.995343148708344 0.979044139385223 0.971936285495758;0.990686297416687 0.958088219165802 0.943872570991516;0.986029386520386 0.937132358551025 0.915808796882629;0.981372535228729 0.916176497936249 0.887745082378387;0.976715683937073 0.895220577716827 0.859681367874146;0.972058832645416 0.874264717102051 0.831617653369904;0.96740198135376 0.853308796882629 0.803553938865662;0.962745070457458 0.832352936267853 0.77549022436142;0.958088219165802 0.811397075653076 0.747426450252533;0.953431367874146 0.790441155433655 0.719362735748291;0.948774516582489 0.769485294818878 0.691299021244049;0.944117665290833 0.748529434204102 0.663235306739807;0.939460813999176 0.72757351398468 0.635171592235565;0.934803903102875 0.706617653369904 0.607107818126678;0.930147051811218 0.685661792755127 0.579044103622437;0.925490200519562 0.664705872535706 0.550980389118195;0.920833349227905 0.643750011920929 0.522916674613953;0.916176497936249 0.622794151306152 0.494852930307388;0.911519587039948 0.601838231086731 0.466789215803146;0.906862735748291 0.580882370471954 0.438725501298904;0.902205884456635 0.559926450252533 0.41066175699234;0.897549033164978 0.538970589637756 0.382598042488098;0.892892181873322 0.51801472902298 0.354534327983856;0.888235330581665 0.497058838605881 0.326470583677292;0.883578419685364 0.476102948188782 0.29840686917305;0.878921568393707 0.455147057771683 0.270343124866486;0.874264717102051 0.434191197156906 0.242279410362244;0.869607865810394 0.413235306739807 0.214215680956841;0.864951014518738 0.392279416322708 0.186151966452599;0.860294103622437 0.371323525905609 0.158088237047195;0.85563725233078 0.350367665290833 0.130024507641792;0.850980401039124 0.329411774873734 0.10196078568697];

%% Load data generated with MFI script.
load dataMFI.mat

%% Load reference free energy surface.
n=60;
DATAREF=load('fes_ap_10E9.dat');
FREF=reshape(DATAREF(:,3),n,n);
FREF=FREF-min(min(FREF));
PSIREF=reshape(DATAREF(:,1),n,n);
PHIREF=reshape(DATAREF(:,2),n,n);

FxREF=-kT.*log(sum(exp(-FREF./kT)));
FyREF=-kT.*log(sum(exp(-FREF'./kT)));



%% Plot free energy
hFig=figure(1);
set(hFig,'Position',[0 0 1000 400])
subplot(2,4,[1 2 5 6])
contourf(GRIDX,GRIDY,FES,(0:5:Flim),'LineColor','k','LineStyle','-')
hold on
%% Superimpose contours from reference FES
contour(PSIREF,PHIREF,FREF,(0:5:Flim),'LineColor','g','LineStyle','--','LineWidth',1.5)
colorbar
set(gca,'FontSize',18,'LineWidth',2.0)
set(gca,'TickLabelInterpreter','latex')
xlabel('$\mathbf{s_1}$','Interpreter','latex')
ylabel('$\mathbf{s_2}$','Interpreter','latex')
colormap(BluetoRed)
xlim([-pi pi])
ylim([-pi pi])
caxis([0 Flim])
hFig=figure(1);
set(hFig,'Position',[100 100 1000 500])

%% Compare 1D projections
subplot(2,4,[3 4])
plot(gridx,Fx-min(Fx),'b-','LineWidth',2.0,'MarkerSize',10)
box on
hold on
plot(PSIREF(:,1),FyREF-min(FyREF),'g-.','LineWidth',2.0,'MarkerSize',10)
box on
set(gca,'FontSize',18,'LineWidth',2.0)
set(gca,'TickLabelInterpreter','latex')
xlabel('$\mathbf{s_1}$','Interpreter','latex')
xlim([-pi pi])
subplot(2,4,[7 8])
plot(gridy,Fy-min(Fy),'r-','LineWidth',2.0,'MarkerSize',10)
box on
hold on
plot(PSIREF(:,1),FxREF-min(FxREF),'g-.','LineWidth',2.0,'MarkerSize',10)
box on
set(gca,'FontSize',18,'LineWidth',2.0)
set(gca,'TickLabelInterpreter','latex')
xlim([-pi pi])
xlabel('$\mathbf{s_2}$','Interpreter','latex')


%% Compute absolute deviation w/r to reference FES
FES_ds=FES(1:3:end,1:3:end);
AD=abs(FREF-FES_ds');
hFig=figure(2);
contourf(PSIREF,PHIREF,AD,[10],'LineColor','k','LineStyle','-')
colorbar
set(gca,'FontSize',18,'LineWidth',2.0)
set(gca,'TickLabelInterpreter','latex')
xlabel('$\mathbf{s_1}$','Interpreter','latex')
ylabel('$\mathbf{s_2}$','Interpreter','latex')
colormap(BluetoRed)



